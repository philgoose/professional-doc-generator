<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Global Admin OS v6.0 - Advanced Table & Auto Seal</title>
    <style>
        :root { --navy: #0a192f; --gold: #c5a059; --bg: #222; --paper: #fff; }
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; background: var(--bg); display: flex; height: 100vh; color: #fff; overflow: hidden; }
        .sidebar { width: 450px; background: #111; padding: 20px; overflow-y: auto; border-right: 2px solid var(--gold); }
        .sidebar h2 { color: var(--gold); border-bottom: 2px solid var(--gold); padding-bottom: 10px; font-size: 1.2em; }
        .group { margin-bottom: 12px; }
        label { display: block; font-size: 11px; color: #888; margin-bottom: 4px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border-radius: 4px; border: none; background: #2a2a2a; color: #fff; font-size: 13px; box-sizing: border-box; }
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .btn { padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; transition: 0.2s; }
        .btn-save { background: #28a745; color: white; }
        .btn-table { background: #007bff; color: white; }
        .preview-area { flex: 1; padding: 30px; overflow-y: auto; display: flex; justify-content: center; background: #333; }
        .paper { width: 210mm; min-height: 297mm; background: var(--paper); color: #000; padding: 25mm 20mm; box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative; }
        
        /* 공문서 내부 표 스타일 */
        .doc-table { width: 100%; border-collapse: collapse; margin-top: 15px; margin-bottom: 15px; }
        .doc-table th, .doc-table td { border: 1px solid #000; padding: 8px; text-align: center; font-size: 14px; }
        .doc-table th { background: #f2f2f2; }

        .doc-header { text-align: center; font-weight: bold; border-bottom: 3px double #000; padding-bottom: 10px; margin-bottom: 25px; font-size: 32px; }
        .main-text { line-height: 1.8; text-align: justify; min-height: 500px; }
        
        /* 자동 생성 직인 스타일 */
        #seal-canvas { position: absolute; right: 60px; bottom: 90px; width: 80px; height: 80px; z-index: 5; opacity: 0.8; transform: rotate(-5deg); pointer-events: none; }
        
        .footer { text-align: center; font-weight: bold; margin-top: 50px; font-size: 22px; border-top: 2px solid #000; padding-top: 15px; }
        .print-btn { position: fixed; bottom: 30px; right: 30px; padding: 15px 30px; background: var(--gold); color: #000; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; }
        @media print { .sidebar, .print-btn { display: none; } .preview-area { padding: 0; } .paper { box-shadow: none; width: 100%; margin: 0; } }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>ADMIN OS v6.0</h2>
        <div class="group"><label>보고 단계</label><select id="tSel" onchange="applySample()"><option value="normal">일반</option><option value="initial">최초보고</option><option value="interim">중간보고</option><option value="final">최종보고</option><option value="urgent">긴급</option></select></div>
        <div class="group"><label id="lb0">발신기관</label><input type="text" id="i0" value="대한혁신연구소" oninput="drawSeal(); u();"></div>
        <div class="group"><label id="lb1">수신</label><input type="text" id="i1" oninput="u()"></div>
        <div class="group"><label id="lb2">제목</label><input type="text" id="i2" oninput="u()"></div>
        <div class="group"><label>본문 내용 편집</label>
            <button class="btn btn-table" onclick="addTable()">표 양식 삽입</button>
            <textarea id="i3" oninput="u()" style="height:250px; margin-top:5px; font-family: monospace;"></textarea>
        </div>
        <div class="group"><label>발신인</label><input type="text" id="i4" oninput="u()"></div>
        <div class="btn-row">
            <button class="btn btn-save" onclick="saveData()">데이터 저장</button>
            <button class="btn" style="background:#6c757d; color:white;" onclick="document.getElementById('f-data').click()">로드</button>
            <input type="file" id="f-data" accept=".json" style="display:none;" onchange="loadData(event)">
        </div>
    </div>
    <div class="preview-area">
        <div class="paper" id="p-doc">
            <div class="doc-header" id="o0">기 관 명</div>
            <div style="margin-bottom:20px; font-size:14px;">
                <b>수 신 :</b> <span id="o1"></span><br>
                <b>제 목 :</b> <span id="o2" style="font-weight:bold;"></span>
            </div>
            <div class="main-text" id="o3"></div>
            <canvas id="seal-canvas" width="200" height="200"></canvas>
            <div class="footer" id="o4">발신인 명의</div>
            <div style="margin-top:40px; font-size:12px; border-top:1px solid #eee; padding-top:10px;">
                일자: <span id="o-date"></span> | 기안: 임태훈
            </div>
        </div>
    </div>
    <button class="print-btn" onclick="window.print()">PDF 발행</button>

    <script>
        // 표 양식 HTML 코드
        const tableHTML = `
<table class="doc-table">
    <tr><th>구분</th><th>세부 내용</th><th>비고</th></tr>
    <tr><td>항목1</td><td>내용을 입력하세요</td><td>-</td></tr>
    <tr><td>항목2</td><td>내용을 입력하세요</td><td>-</td></tr>
</table>`;

        function addTable() {
            const area = document.getElementById('i3');
            area.value += tableHTML;
            u();
        }

        // 직인 자동 생성 (Canvas 기술)
        function drawSeal() {
            const canvas = document.getElementById('seal-canvas');
            const ctx = canvas.getContext('2d');
            const name = document.getElementById('i0').value.substring(0, 4) || "직인";
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // 외곽선
            ctx.strokeStyle = "red";
            ctx.lineWidth = 10;
            ctx.strokeRect(20, 20, 160, 160);
            // 텍스트
            ctx.fillStyle = "red";
            ctx.font = "bold 45px 'Gungsuh', serif";
            ctx.textAlign = "center";
            ctx.fillText(name.substring(0,2), 100, 85);
            ctx.fillText(name.substring(2,4) || "인", 100, 145);
        }

        function u() {
            document.getElementById('o0').innerText = document.getElementById('i0').value;
            document.getElementById('o1').innerText = document.getElementById('i1').value;
            document.getElementById('o2').innerText = document.getElementById('i2').value;
            document.getElementById('o3').innerHTML = document.getElementById('i3').value; // HTML 허용
            document.getElementById('o4').innerText = document.getElementById('i4').value;
        }

        function applySample() {
            const stage = document.getElementById('tSel').value;
            const samples = {
                initial: "1. 개요: 신규 프로젝트 착수 보고\n2. 현황:" + tableHTML,
                interim: "1. 중간 점검 결과\n" + tableHTML,
                final: "1. 최종 성과 보고\n" + tableHTML,
                urgent: "<b>[긴급 조치 사항]</b>\n현 시각부로 보안 점검을 실시함.",
                normal: "내용을 입력하십시오."
            };
            document.getElementById('i3').value = samples[stage];
            u();
        }

        function saveData() {
            const d = {}; for(let i=0; i<=4; i++) d['i'+i] = document.getElementById('i'+i).value;
            const b = new Blob([JSON.stringify(d)], {type:'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'admin_v6.json'; a.click();
        }

        function loadData(e) {
            const r = new FileReader(); r.onload = () => {
                const d = JSON.parse(r.target.result);
                for(let i=0; i<=4; i++) document.getElementById('i'+i).value = d['i'+i] || "";
                u(); drawSeal();
            }; r.readAsText(e.target.files[0]);
        }

        document.getElementById('o-date').innerText = new Date().toLocaleDateString();
        window.onload = () => { drawSeal(); applySample(); };
    </script>
</body>
</html>
